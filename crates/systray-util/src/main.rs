use systray_util::{IconEvent, Systray};

fn main() -> systray_util::Result<()> {
  tracing_subscriber::fmt().init();

  let mut systray = Systray::new()?;

  let mut index = 0;
  while let Some(event) = systray.events_blocking() {
    println!("{} Event: {:?}", index, event);
    index += 1;

    // Every 25 events, send a test event.
    if index % 25 == 0 {
      println!("================================================");
      println!("================================================");
      println!("================================================");
      println!("================================================");
      println!("================================================");
      println!("================================================");
      println!("================================================");
      println!("================================================");
      println!("================================================");
      println!("================================================");
      println!("================================================");
      println!("================================================");
      println!("================================================");
      println!("================================================");
      println!("================================================");
      println!("================================================");
      println!("================================================");
      println!("================================================");
      println!("================================================");
      println!("================================================");
      println!("================================================");
      println!("================================================");
      println!("================================================");
      println!("================================================");
      println!("================================================");
      println!("================================================");
      println!("================================================");
      println!("================================================");
      println!("================================================");
      println!("================================================");
      println!("================================================");
      println!("================================================");
      println!("================================================");
      println!("================================================");
      println!("Sending right click");
      let icon = systray.icons().get(index / 25).cloned().unwrap();
      println!("Icon: {:?}", icon);
      systray.send_icon_event(icon.uid, IconEvent::RightClick)?;
    }
  }

  Ok(())
}
